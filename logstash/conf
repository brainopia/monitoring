input {
  lumberjack {
    port => 6789
    ssl_certificate => "/etc/logstash/server.crt"
    ssl_key => "/etc/logstash/server.key"
  }
}

filter {
  if [type] == "nginx-access" {
    grok {
      patterns_dir => "/etc/logstash/patterns"
      match => [ "message", "%{NGINX_ACCESS}" ]
    }
    geoip {
      source => "client_ip"
    }
  }
}

output {
  elasticsearch {
    host => elasticsearch
    protocol => http
  }
}
